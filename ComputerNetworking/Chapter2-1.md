### Chapter 2 应用层

应用层：包括应用程序所需要的网络服务、客户和服务器、进程个运输层接口。

#### 2.1 应用层协议原理

​	研发网络应用程序的核心是写出能够运行在不同的端系统和通过网络批次通信的程序。

 1. 网络应用程序体系结构

     * 客户 - 服务器体系结构

    ​	在该结构中有一个总是打开的主机称为服务器，它服务于来自许多其他称为客户的主机请求。

    * P2P体系机构

    ​	应用程序在尖端连接的主机对之间直接通信。该结构的特性之一是自扩展性。

 2. 进程通信

    用操作系统的术语来说，进行通信的实际上是进程（process）而不是程序；在两个不同端系统上的进程，通过跨越计算机网络交换报文而相互通信。

    *  客户和服务器进程

      网络应用程序由成对的进程组成，这些进程通过网络互相发送报文。在每对通信进程的通信会话场景中，发起通信的进程被标识为客户，在会话开始等待联系的进程是服务器。

    * 进程与计算机网络之间的接口

      进程通过一个称为套接字（socket）的软件接口向网络发送报文和从网络接收报文。套接字是同一台主机内应用层与传输层之间的接口。也被称为应用程序和网络之间的应用程序编程接口（API）

      应用程序开发者对于运输层的控制仅限于: 1.选择运输层协议；2.设定几个运输层参数。

    * 进程寻址

      在一台主机上运行的进程为了向另一台主机上运行的进程发送分组，接收进程需要有一个地址。

      为了标识该接受进程，需要定义两种信息：1.主机地址；2.在目的主机中制定接受进程的标识符。在因特网中，主机由IP地址标识，接受进程由目的地端口号标识。

 3. 可供应用程序使用的运输服务

    运输层协议是多种多样的，开发一个应用时，必须选择一个最能为应用需求提供恰当服务的协议。

    应用程序的服务要求大体分为四个方面：可靠数据传输、吞吐量、定时和安全性。

    + 可靠数据传输

      分组在计算机网络中可能丢失。如果一个协议能够确保应用程序的一段发送的数据正确、完整的交付给该应用程序的另一端，就认为该协议拱了可靠数据传输。

    + 吞吐量

      在两个进程间的通信场景中，可用吞吐量就是发送进程能够向接收进程交付比特的速率。

      具有吞吐量要求的应用程序被称为带宽敏感的应用。弹性应用能够根据当时可用的带宽或多或少地利用可供使用的吞吐量

    + 定时

      运输层协议也能提供定时保证。定时保证能够以多种形式实现。

    + 安全性

      运输层协议能够为应用程序提供一种或多种安全性服务。例如：机密性、数据完整性等

4. 因特网提供的运输服务

   因特网为应用程序提供两个运输层协议：TCP 和 UDP。TCP和UDP都没有提供任何加密机制。因特网运输协议不提供吞吐量服务和定时服务。

   1. TCP服务

      TCP服务模型包括面向连接的服务和可靠的数据传送服务

   2. UDP服务

      UDP是一种不提供不必要服务的轻量级运输协议，仅提供最小服务，是一种不可靠数据传输服务。

5. 应用层协议

   应用层协议定义了运行在不同端系统上的应用程序如何相互传递报文。应用层协议定义了：

   + 交换的报文类型，例如: 请求报文和响应报文
   + 各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的
   + 字段的语义，即这些字段中的信息的含义
   + 确定一个进程何时及如何发送报文，对报文进行响应的规则

   区分网络应用和应用层协议是很重要的，应用层协议只是网络应用的一部分。

6. 主要关注的网络应用

   Web、文件传输、电子邮件、目录服务、流媒体和P2P

#### 2.2 Web和HTTP

1. HTTP概况

   Web的应用层协议是超文本传输协议(HTTP)，它是Web的核心，HTTP由两个程序实现：客户程序和服务器程序。

   Web页面（也叫文档）是由对象组成的。一个对象只是一个文件，如：一个HTML文件、一个JPEG图形等。

   Web浏览器是实现HTTP协议的客户端，Web服务器是实现了HTTP的服务器端。

   HTTP协议定义了Web客户端向Web服务器请求Web页面的方式，以及服务器向客户传送Web页面的方式。HTTP使用TCP作为它的支撑运输协议。HTTP是一个无状态协议，HTTP服务器不保存关于客户的任何信息。

2. 非持续性连接和持续连接

   非持续性连接：即每个请求/响应对是经由一个单独的TCP连接发送

   ​	每个TCP连接在服务器发送一个对象后就关闭，对Web服务器带来严重的负担

   持续性连接： 所有的请求及其相应经相同的TCP连接发送

   ​	允许在同一个连接中多个请求和回答交错

3. HTTP报文格式

   + 请求报文：至少一行，第一行是请求行，后继行叫首部行；请求航有3个字段：方法字段、URL字段和HTTP版本字段 
   + 响应报文：有三个发部分：一个初始状态行、6个首部行、实体体（entity body）

4. 用户与服务器的交互：cookie

   因为HTTP服务器无法保存用户信息，为了实现站点对用户进行跟踪，HTTP使用了cookie。

   cookie有4个组件： 1.在HTTP响应报文中的一个cookie首部行；2.在HTTP请求报文中的一个cookie首部行；3.用户端系统中保留有一个cookie文件，并由用户的浏览器进行管理；4.位于Web站点的一个后端数据库。

5. Web缓存

   Web缓存器也叫代理服务器，它是能够代表初始服务器来满足HTTP请求的网络实体。Web缓存器可以大大减少对客户请求的响应时间。Web缓存器既是服务器又是客户。

   通过内容分发网络（CDN），Web缓存器在因特网中发挥越来越重要的作用。

6. 条件GET方法

   条件GET方法，允许缓存器正式它的对象是最新的。

   如果一个HTTP请求有以下两个特征：1.请求报文使用GET方法，2.请求报文包含一个“If-Modify-Since:”首部行，那么这个HTTP请求报文就是一个条件GET请求报文。

